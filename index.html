<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKOPI - Sistem Kinerja Operasi dan Pemeliharaan Irigasi</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Ganti Mapbox dengan Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Map Styles */
#map {
    height: 400px;
    border-radius: 10px;
    margin: 1rem 0;
    border: 2px solid #3498db;
}
.leaflet-popup-content-wrapper {
    border-radius: 8px;
}
.leaflet-popup-content {
    margin: 8px 12px;
    line-height: 1.4;
}
/* Custom marker styles */
.irrigation-marker {
    background-color: #3498db;
    border: 2px solid #fff;
    border-radius: 50%;
    width: 20px;
    height: 20px;
}
.irrigation-marker.bendung {
    background-color: #e74c3c;
}
.irrigation-marker.saluran {
    background-color: #27ae60;
}
.irrigation-marker.bangunan {
    background-color: #f39c12;
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .container {
            display: flex;
            min-height: calc(100vh - 100px);
        }

        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 1rem 0;
        }

        .menu-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
        }

        .menu-item.active {
            background-color: #3498db;
            color: white;
            border-left: 4px solid #2980b9;
        }

        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h4 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            opacity: 0.9;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            z-index: 1000;
        }

        .loading-overlay i {
            font-size: 2rem;
            color: #3498db;
            margin-right: 1rem;
        }

        /* Error Message */
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Success Message */
        .success-message {
            background: #27ae60;
            color: white;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Last Update Info */
        .last-update {
            text-align: right;
            color: #666;
            font-size: 0.8rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        /* Refresh Button */
        .refresh-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: background 0.3s ease;
        }

        .refresh-btn:hover {
            background: #2980b9;
        }

        .refresh-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        /* Status indicators */
        .status-normal {
            color: #27ae60;
        }

        .status-warning {
            color: #f39c12;
        }

        .status-error {
            color: #e74c3c;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
            }
            
            .content {
                order: 1;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.refresh-btn {
    background: #3498db;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.refresh-btn:hover {
    background: #2980b9;
    transform: translateY(-2px);
}

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.monitoring-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.monitoring-item {
    text-align: center;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #3498db;
}

.monitoring-item h5 {
    margin-bottom: 0.5rem;
    color: #2c3e50;
    font-size: 0.9rem;
}

.monitoring-value {
    font-size: 1.2rem;
    font-weight: bold;
    color: #3498db;
}

.monitoring-value.normal {
    color: #27ae60;
}

.monitoring-value.warning {
    color: #f39c12;
}

.alert-info {
    background: #e3f2fd;
    border: 1px solid #2196f3;
    border-radius: 5px;
    padding: 1rem;
    margin-top: 1rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.alert-info i {
    color: #2196f3;
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #27ae60;
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 5px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.stat-card h4 {
    transition: transform 0.2s ease;
}
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-tint"></i> SKOPI</h1>
        <p>Sistem Kinerja Operasi dan Pemeliharaan Irigasi - DI. Molek</p>
    </div>
    <!-- Dashboard Section -->
<div id="dashboard" class="content-section active">
    <div class="dashboard-header">
        <h2>Dashboard SKOPI</h2>
        <button onclick="refreshDashboard()" class="refresh-btn">
            <i class="fas fa-sync-alt"></i> Refresh Data
        </button>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <h4 id="total-petugas">15</h4>
            <p>Total Petugas</p>
        </div>
        <div class="stat-card">
            <h4 id="tingkat-kehadiran">85%</h4>
            <p>Tingkat Kehadiran</p>
        </div>
        <div class="stat-card">
            <h4 id="luas-layanan">1,250</h4>
            <p>Luas Layanan (Ha)</p>
        </div>
        <div class="stat-card">
            <h4 id="kinerja-bulanan">92%</h4>
            <p>Kinerja Bulanan</p>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <h3>Status Operasional Real-time</h3>
            <ul id="operational-status" style="margin-top: 1rem; padding-left: 2rem;">
                <li>✅ Pintu Air Utama: Normal</li>
                <li>✅ Saluran Primer: Berfungsi Baik</li>
                <li>⚠️ Saluran Sekunder Blok C: Perlu Pembersihan</li>
                <li>✅ Bangunan Bagi: Normal</li>
            </ul>
        </div>

        <div class="card">
            <h3>Data Monitoring</h3>
            <div id="monitoring-data">
                <!-- Data monitoring akan diisi oleh JavaScript -->
            </div>
        </div>
    </div>

    <div class="card">
        <h3>Grafik Kinerja Mingguan</h3>
        <div class="chart-container">
            <canvas id="dashboardChart"></canvas>
        </div>
    </div>

    <div class="card">
        <h3>Ringkasan Sistem</h3>
        <p>Selamat datang di SKOPI (Sistem Kinerja Operasi dan Pemeliharaan Irigasi) DI. Molek. 
        Sistem ini membantu dalam monitoring dan evaluasi kinerja operasional jaringan irigasi.</p>
        
        <div class="alert-info">
            <i class="fas fa-info-circle"></i>
            <span>Data diperbarui secara otomatis setiap 30 detik. Klik tombol refresh untuk pembaruan manual.</span>
        </div>
    </div>
</div>
    <div class="container">
        <div class="sidebar">
            <div class="menu-item active" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="menu-item" onclick="showSection('profil')">
                <i class="fas fa-info-circle"></i> Profil Jaringan Irigasi
            </div>
            <div class="menu-item" onclick="showSection('peta')">
                <i class="fas fa-map"></i> Peta Layout
            </div>
            <div class="menu-item" onclick="showSection('skema')">
                <i class="fas fa-project-diagram"></i> Skema Irigasi
            </div>
            <div class="menu-item" onclick="showSection('tenaga')">
                <i class="fas fa-users"></i> Tenaga dan Absensi
            </div>
            <div class="menu-item" onclick="showSection('progres')">
                <i class="fas fa-chart-line"></i> Bobot Progres Harian
            </div>
            <div class="menu-item" onclick="showSection('kurva')">
                <i class="fas fa-chart-area"></i> Kurva S Kinerja Bulanan
            </div>
        </div>

        <div class="content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section active">
                <!-- Refresh Button -->
                <button class="refresh-btn" onclick="manualRefresh()">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4 id="total-petugas">15</h4>
                        <p>Total Petugas</p>
                    </div>
                    <div class="stat-card">
                        <h4 id="tingkat-kehadiran">85%</h4>
                        <p>Tingkat Kehadiran</p>
                    </div>
                    <div class="stat-card">
                        <h4 id="luas-layanan">1,250</h4>
                        <p>Luas Layanan (Ha)</p>
                    </div>
                    <div class="stat-card">
                        <h4 id="kinerja-bulanan">92%</h4>
                        <p>Kinerja Bulanan</p>
                    </div>
                </div>

                <!-- System Summary Card -->
                <div class="card">
                    <h3>Ringkasan Sistem</h3>
                    <p>Selamat datang di SKOPI (Sistem Kinerja Operasi dan Pemeliharaan Irigasi) DI. Molek. 
                    Sistem ini membantu dalam monitoring dan evaluasi kinerja operasional jaringan irigasi.</p>
                    
                    <div style="margin-top: 2rem;">
                        <h4>Status Operasional Hari Ini:</h4>
                        <ul id="status-operasional" style="margin-top: 1rem; padding-left: 2rem;">
                            <!-- Status akan diisi secara dinamis -->
                        </ul>
                    </div>

                    <!-- Last Update Info -->
                    <div class="last-update" id="last-update">
                        <!-- Timestamp akan diisi secara dinamis -->
                    </div>
                </div>
            </div>

            <!-- Profil Jaringan Irigasi Section -->
            <div id="profil" class="content-section">
                <div class="card">
                    <h3>Profil DI. Molek</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                        <div>
                            <h4>Informasi Umum</h4>
                            <table>
                                <tr><td><strong>Nama Daerah Irigasi</strong></td><td>DI. Molek</td></tr>
                                <tr><td><strong>Lokasi</strong></td><td>Kabupaten Malang, Jawa Timur</td></tr>
                                <tr><td><strong>Luas Baku</strong></td><td id="luas-baku">1,250 Ha</td></tr>
                                <tr><td><strong>Luas Fungsional</strong></td><td>1,180 Ha</td></tr>
                                <tr><td><strong>Jenis Irigasi</strong></td><td>Teknis</td></tr>
                                <tr><td><strong>Sumber Air</strong></td><td>Sungai Brantas</td></tr>
                            </table>
                        </div>
                        <div>
                            <h4>Infrastruktur</h4>
                            <table>
                                <tr><td><strong>Bendung Utama</strong></td><td>1 Unit</td></tr>
                                <tr><td><strong>Saluran Primer</strong></td><td>8.5 Km</td></tr>
                                <tr><td><strong>Saluran Sekunder</strong></td><td>15.2 Km</td></tr>
                                <tr><td><strong>Saluran Tersier</strong></td><td>28.7 Km</td></tr>
                                <tr><td><strong>Bangunan Bagi</strong></td><td>12 Unit</td></tr>
                                <tr><td><strong>Bangunan Sadap</strong></td><td>45 Unit</td></tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sections lainnya tetap sama... -->
            <!-- Peta Layout Section -->
<div id="peta" class="content-section">
    <div class="card">
        <h3>Peta Layout DI. Molek</h3>
        <p>Peta menunjukkan lokasi infrastruktur irigasi DI. Molek termasuk bendung, saluran, dan bangunan pendukung.</p>
        
        <!-- Map Container -->
        <div id="map"></div>
        
        <!-- Map Legend -->
        <div class="map-legend" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 5px;">
            <h4>Legenda:</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.5rem;">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <div class="irrigation-marker bendung"></div>
                    <span>Bendung Utama</span>
                </div>
                <div style="display: flex; align-items: center; gap: 5px;">
                    <div class="irrigation-marker saluran"></div>
                    <span>Saluran Primer</span>
                </div>
                <div style="display: flex; align-items: center; gap: 5px;">
                    <div class="irrigation-marker bangunan"></div>
                    <span>Bangunan Bagi</span>
                </div>
                <div style="display: flex; align-items: center; gap: 5px;">
                    <div class="irrigation-marker"></div>
                    <span>Infrastruktur Lainnya</span>
                </div>
            </div>
        </div>
    </div>
</div>
        </div>
    </div>

    <script>
        // ===== POINT 1: STRUKTUR DATA JAVASCRIPT =====
        let dashboardData = {
            stats: {
                totalPetugas: 15,
                tingkatKehadiran: 85,
                luasLayanan: 1250,
                kinerjaBulanan: 92
            },
            statusOperasional: [
                { item: "Pintu Air Utama", status: "normal", icon: "✅" },
                { item: "Saluran Primer", status: "normal", icon: "✅" },
                { item: "Saluran Sekunder Blok C", status: "warning", icon: "⚠️" },
                { item: "Bangunan Bagi", status: "normal", icon: "✅" }
            ],
            lastUpdate: new Date()
        };

        // ===== POINT 2: FUNGSI UPDATE DATA STATISTIK =====
        function updateDashboardStats(data) {
            // Update stat cards dengan ID yang spesifik
            document.getElementById('total-petugas').textContent = data.stats.totalPetugas;
            document.getElementById('tingkat-kehadiran').textContent = data.stats.tingkatKehadiran + '%';
            document.getElementById('luas-layanan').textContent = data.stats.luasLayanan.toLocaleString();
            document.getElementById('kinerja-bulanan').textContent = data.stats.kinerjaBulanan + '%';
            
            // Update luas baku di profil juga
            const luasBaku = document.getElementById('luas-baku');
            if (luasBaku) {
                luasBaku.textContent = data.stats.luasLayanan + ' Ha';
            }
        }

        // ===== POINT 3: FUNGSI UPDATE STATUS OPERASIONAL =====
        function updateOperationalStatus(statusData) {
            const statusContainer = document.getElementById('status-operasional');
            if (statusContainer) {
                statusContainer.innerHTML = '';
                
                statusData.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `${item.icon} ${item li.innerHTML = `${item.icon} ${item.item}: <span class="status-${item.status}">${getStatusText(item.status)}</span>`;
                    statusContainer.appendChild(li);
                });
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'normal': 'Normal',
                'warning': 'Perlu Perhatian',
                'error': 'Bermasalah'
            };
            return statusMap[status] || 'Unknown';
        }

        // ===== POINT 4: INTEGRASI DENGAN API/DATABASE =====
        
        // A. Menggunakan Fetch API
        async function fetchDashboardData() {
            try {
                showLoading();
                
                // Simulasi API call - ganti dengan URL API yang sebenarnya
                // const response = await fetch('/api/dashboard-data');
                // const data = await response.json();
                
                // Simulasi data dari server
                const simulatedData = await simulateAPICall();
                
                // Update dashboard dengan data baru
                updateDashboardStats(simulatedData);
                updateOperationalStatus(simulatedData.statusOperasional);
                updateLastRefresh();
                
                hideLoading();
                showSuccessMessage('Data berhasil diperbarui');
                
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
                hideLoading();
                showErrorMessage('Gagal memuat data dashboard');
            }
        }

        // Simulasi API call untuk demo
        function simulateAPICall() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Simulasi data yang berubah
                    const newData = {
                        stats: {
                            totalPetugas: Math.floor(Math.random() * 5) + 13, // 13-17
                            tingkatKehadiran: Math.floor(Math.random() * 20) + 80, // 80-99
                            luasLayanan: 1250,
                            kinerjaBulanan: Math.floor(Math.random() * 15) + 85 // 85-99
                        },
                        statusOperasional: [
                            { item: "Pintu Air Utama", status: "normal", icon: "✅" },
                            { item: "Saluran Primer", status: Math.random() > 0.7 ? "warning" : "normal", icon: Math.random() > 0.7 ? "⚠️" : "✅" },
                            { item: "Saluran Sekunder Blok C", status: Math.random() > 0.5 ? "warning" : "normal", icon: Math.random() > 0.5 ? "⚠️" : "✅" },
                            { item: "Bangunan Bagi", status: "normal", icon: "✅" }
                        ]
                    };
                    resolve(newData);
                }, 1500); // Simulasi delay 1.5 detik
            });
        }

        // B. Auto-refresh Data
        let autoRefreshInterval;
        
        function startAutoRefresh() {
            // Auto refresh setiap 5 menit (300000 ms)
            // Untuk demo, gunakan 30 detik (30000 ms)
            autoRefreshInterval = setInterval(fetchDashboardData, 30000);
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        }

        // ===== POINT 5: IMPLEMENTASI LENGKAP DALAM HTML =====
        
        // Fungsi update dashboard utama
        function updateDashboard() {
            updateDashboardStats(dashboardData);
            updateOperationalStatus(dashboardData.statusOperasional);
            updateLastRefresh();
        }

        // Simulasi update data real-time
        function simulateDataUpdate() {
            // Update random data
            dashboardData.stats.tingkatKehadiran = Math.floor(Math.random() * 20) + 80;
            dashboardData.stats.kinerjaBulanan = Math.floor(Math.random() * 15) + 85;
            dashboardData.stats.totalPetugas = Math.floor(Math.random() * 5) + 13;
            
            // Random status update
            dashboardData.statusOperasional[1].status = Math.random() > 0.7 ? "warning" : "normal";
            dashboardData.statusOperasional[1].icon = dashboardData.statusOperasional[1].status === "warning" ? "⚠️" : "✅";
            
            dashboardData.statusOperasional[2].status = Math.random() > 0.5 ? "warning" : "normal";
            dashboardData.statusOperasional[2].icon = dashboardData.statusOperasional[2].status === "warning" ? "⚠️" : "✅";
            
            // Update dashboard
            updateDashboard();
        }

        function updateLastRefresh() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            const dateString = now.toLocaleDateString('id-ID');
            
            const updateInfo = document.getElementById('last-update');
            if (updateInfo) {
                updateInfo.innerHTML = `<i class="fas fa-clock"></i> Terakhir diperbarui: ${dateString} ${timeString}`;
            }
        }

        // ===== POINT 6: INTEGRASI DENGAN BACKEND =====
        
        // Fungsi untuk mengirim data ke backend
        async function sendDataToBackend(data) {
            try {
                const response = await fetch('/api/update-dashboard', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Error sending data to backend:', error);
                throw error;
            }
        }

        // ===== POINT 7: FITUR TAMBAHAN =====
        
        // A. Loading State
        function showLoading() {
            const dashboard = document.querySelector('#dashboard');
            
            // Remove existing loader
            hideLoading();
            
            const loader = document.createElement('div');
            loader.className = 'loading-overlay';
            loader.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memuat data...';
            
            dashboard.appendChild(loader);
            
            // Disable refresh button
            const refreshBtn = document.querySelector('.refresh-btn');
            if (refreshBtn) {
                refreshBtn.disabled = true;
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            }
        }

        function hideLoading() {
            const loader = document.querySelector('.loading-overlay');
            if (loader) {
                loader.remove();
            }
            
            // Enable refresh button
            const refreshBtn = document.querySelector('.refresh-btn');
            if (refreshBtn) {
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Data';
            }
        }

        // B. Error Handling
        function showErrorMessage(message) {
            // Remove existing messages
            removeMessages();
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            
            const dashboard = document.querySelector('#dashboard');
            dashboard.insertBefore(errorDiv, dashboard.firstChild);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        function showSuccessMessage(message) {
            // Remove existing messages
            removeMessages();
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            
            const dashboard = document.querySelector('#dashboard');
            dashboard.insertBefore(successDiv, dashboard.firstChild);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 3000);
        }

        function removeMessages() {
            const messages = document.querySelectorAll('.error-message, .success-message');
            messages.forEach(msg => msg.remove());
        }

        // ===== FUNGSI NAVIGASI (dari kode asli) =====
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Update menu active state
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked menu item
            const activeMenuItem = Array.from(menuItems).find(item => 
                item.getAttribute('onclick').includes(sectionId)
            );
            if (activeMenuItem) {
                activeMenuItem.classList.add('active');
            }
            
            // If switching to dashboard, refresh data
            if (sectionId === 'dashboard') {
                fetchDashboardData();
            }
        }

        // ===== FUNGSI MANUAL REFRESH =====
        function manualRefresh() {
            fetchDashboardData();
        }

        // ===== INISIALISASI SAAT HALAMAN DIMUAT =====
        document.addEventListener('DOMContentLoaded', function() {
            // Initial load
            updateDashboard();
            
            // Start auto refresh
            startAutoRefresh();
            
            // Add event listeners
            window.addEventListener('beforeunload', function() {
                stopAutoRefresh();
            });
            
            // Handle visibility change (pause auto-refresh when tab is not active)
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    stopAutoRefresh();
                } else {
                    startAutoRefresh();
                    // Refresh data when tab becomes active again
                    fetchDashboardData();
                }
            });
        });

        // ===== FUNGSI UTILITAS TAMBAHAN =====
        
        // Format angka dengan pemisah ribuan
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Generate random data untuk testing
        function generateRandomData() {
            return {
                stats: {
                    totalPetugas: Math.floor(Math.random() * 10) + 10,
                    tingkatKehadiran: Math.floor(Math.random() * 30) + 70,
                    luasLayanan: 1250,
                    kinerjaBulanan: Math.floor(Math.random() * 20) + 80
                },
                statusOperasional: [
                    { item: "Pintu Air Utama", status: Math.random() > 0.9 ? "warning" : "normal", icon: Math.random() > 0.9 ? "⚠️" : "✅" },
                    { item: "Saluran Primer", status: Math.random() > 0.8 ? "warning" : "normal", icon: Math.random() > 0.8 ? "⚠️" : "✅" },
                    { item: "Saluran Sekunder Blok C", status: Math.random() > 0.6 ? "warning" : "normal", icon: Math.random() > 0.6 ? "⚠️" : "✅" },
                    { item: "Bangunan Bagi", status: Math.random() > 0.95 ? "warning" : "normal", icon: Math.random() > 0.95 ? "⚠️" : "✅" }
                ]
            };
        }

        // Export functions for external use (jika diperlukan)
        window.SKOPIDashboard = {
            updateDashboard,
            fetchDashboardData,
            showLoading,
            hideLoading,
            showErrorMessage,
            showSuccessMessage,
            manualRefresh,
            generateRandomData
        };

    </script>
    <script>
// Data sampling random untuk dashboard
const dashboardData = {
    totalPetugas: 15,
    tingkatKehadiran: 85,
    luasLayanan: 1250,
    kinerjaBuilanan: 92,
    
    // Data random untuk grafik dan monitoring
    generateRandomData: function() {
        return {
            kehadiran: Math.floor(Math.random() * 20) + 75, // 75-95%
            debitAir: (Math.random() * 5 + 15).toFixed(2), // 15-20 m³/s
            curahHujan: Math.floor(Math.random() * 50), // 0-50mm
            suhuAir: (Math.random() * 5 + 25).toFixed(1), // 25-30°C
            kondisiPintuAir: Math.random() > 0.8 ? 'Maintenance' : 'Normal',
            statusOperasional: Math.random() > 0.9 ? 'Warning' : 'Normal'
        };
    },
    
    // Data historis untuk grafik
    generateWeeklyData: function() {
        const days = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
        return days.map(day => ({
            day: day,
            kehadiran: Math.floor(Math.random() * 20) + 75,
            kinerja: Math.floor(Math.random() * 25) + 70,
            pemeliharaan: Math.floor(Math.random() * 10) + 5
        }));
    }
};

// Fungsi untuk update dashboard secara real-time
function updateDashboard() {
    const randomData = dashboardData.generateRandomData();
    
    // Update stat cards dengan animasi
    updateStatCard('tingkat-kehadiran', randomData.kehadiran + '%');
    updateStatCard('kinerja-bulanan', (Math.floor(Math.random() * 15) + 85) + '%');
    
    // Update status operasional
    updateOperationalStatus(randomData);
    
    // Update monitoring data
    updateMonitoringData(randomData);
    
    // Update grafik
    updateDashboardChart();
}

// Fungsi untuk update stat card dengan animasi
function updateStatCard(id, value) {
    const element = document.getElementById(id);
    if (element) {
        element.style.transform = 'scale(1.1)';
        element.textContent = value;
        setTimeout(() => {
            element.style.transform = 'scale(1)';
        }, 200);
    }
}

// Fungsi untuk update status operasional
function updateOperationalStatus(data) {
    const statusContainer = document.getElementById('operational-status');
    if (statusContainer) {
        const statuses = [
            { name: 'Pintu Air Utama', status: data.kondisiPintuAir },
            { name: 'Saluran Primer', status: data.statusOperasional },
            { name: 'Debit Air', value: data.debitAir + ' m³/s' },
            { name: 'Curah Hujan', value: data.curahHujan + ' mm' }
        ];
        
        let statusHTML = '';
        statuses.forEach(item => {
            const icon = item.status === 'Normal' ? '✅' : item.status === 'Warning' ? '⚠️' : '🔧';
            const statusText = item.status || item.value;
            statusHTML += `<li>${icon} ${item.name}: ${statusText}</li>`;
        });
        
        statusContainer.innerHTML = statusHTML;
    }
}

// Fungsi untuk update data monitoring
function updateMonitoringData(data) {
    const monitoringContainer = document.getElementById('monitoring-data');
    if (monitoringContainer) {
        monitoringContainer.innerHTML = `
            <div class="monitoring-grid">
                <div class="monitoring-item">
                    <h5>Debit Air</h5>
                    <span class="monitoring-value">${data.debitAir} m³/s</span>
                </div>
                <div class="monitoring-item">
                    <h5>Curah Hujan</h5>
                    <span class="monitoring-value">${data.curahHujan} mm</span>
                </div>
                <div class="monitoring-item">
                    <h5>Suhu Air</h5>
                    <span class="monitoring-value">${data.suhuAir}°C</span>
                </div>
                <div class="monitoring-item">
                    <h5>Status Sistem</h5>
                    <span class="monitoring-value ${data.statusOperasional.toLowerCase()}">${data.statusOperasional}</span>
                </div>
            </div>
        `;
    }
}

// Variabel untuk chart
let dashboardChart;

// Fungsi untuk membuat grafik dashboard
function createDashboardChart() {
    const ctx = document.getElementById('dashboardChart');
    if (ctx) {
        const weeklyData = dashboardData.generateWeeklyData();
        
        dashboardChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: weeklyData.map(d => d.day),
                datasets: [{
                    label: 'Tingkat Kehadiran (%)',
                    data: weeklyData.map(d => d.kehadiran),
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Kinerja Operasional (%)',
                    data: weeklyData.map(d => d.kinerja),
                    borderColor: '#27ae60',
                    backgroundColor: 'rgba(39, 174, 96, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Tren Kinerja Mingguan'
                    }
                }
            }
        });
    }
}

// Fungsi untuk update grafik
function updateDashboardChart() {
    if (dashboardChart) {
        const weeklyData = dashboardData.generateWeeklyData();
        dashboardChart.data.datasets[0].data = weeklyData.map(d => d.kehadiran);
        dashboardChart.data.datasets[1].data = weeklyData.map(d => d.kinerja);
        dashboardChart.update();
    }
}

// Fungsi untuk refresh data
function refreshDashboard() {
    updateDashboard();
    showNotification('Data dashboard berhasil diperbarui!');
}

// Fungsi untuk menampilkan notifikasi
function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Auto-update setiap 30 detik
setInterval(updateDashboard, 30000);

// Inisialisasi dashboard saat halaman dimuat
document.addEventListener('DOMContentLoaded', function() {
    updateDashboard();
    createDashboardChart();
});
</script>

</body>
</html>
